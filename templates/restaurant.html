{% extends "base.html" %}

{% block title %}{{ restaurant.name }} - Sips and Steals{% endblock %}

{% block css_path %}../assets/css/main.css{% endblock %}

{% block body_attrs %} data-page="restaurant"{% endblock %}

{% block extra_head %}{% endblock %}

{% block content %}
    <!-- Back Navigation -->
    <div class="back-link">
        <a href="../index.html" role="button" class="outline">‚Üê Back to All Restaurants</a>
    </div>
    
    <!-- Restaurant Header -->
    <header class="restaurant-header">
        <h1>{{ restaurant.name }}</h1>
        <div class="meta">
            {{ restaurant.area }}{% if restaurant.sub_location %} ‚Ä¢ {{ restaurant.sub_location }}{% endif %}
            {% if restaurant.cuisine %} ‚Ä¢ {{ restaurant.cuisine }}{% endif %}
        </div>
    </header>
    
    <!-- Live Deals Section -->
    {% if restaurant.live_deals %}
    <section class="live-deals-section">
        <h3>Current Deals & Specials</h3>
        <p class="live-deals-description">
            Fresh data from {{ restaurant.name }}'s website
            {% if restaurant.last_updated %}‚Ä¢ Updated {{ restaurant.last_updated | time_since }}{% endif %}
        </p>
        
        {% set grouped_deals = restaurant.live_deals | group_deals %}
        {% for group in grouped_deals %}
        <div class="deal-group-card{% if group.is_schedule_group %} schedule-group{% endif %}">
            <div class="deal-group-header">
                <h4 class="deal-group-title">{{ group.title }}</h4>
                <span class="confidence-badge">{{ group.confidence_score | deal_confidence }}</span>
            </div>
            
            {% if not group.is_schedule_group %}
            <div class="deal-group-meta">
                {% if group.days_of_week %}
                    <div class="schedule-info">
                        <span class="schedule-days">{{ group.days_of_week | format_days }}</span>
                        {% if group.start_time and group.end_time %}
                            <span class="schedule-time">{{ group.start_time }} - {{ group.end_time }}</span>
                        {% elif group.is_all_day %}
                            <span class="schedule-time">All Day</span>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
            {% endif %}
            
            {% if group.deals %}
            <div class="deal-group-offerings{% if group.is_schedule_group %} schedule-list{% endif %}">
                {% for offering in group.deals %}
                <div class="deal-offering{% if group.is_schedule_group %} schedule-entry{% endif %}">
                    {% if group.is_schedule_group %}
                        {{ offering.description }}
                    {% else %}
                        {% if offering.description %}
                            ‚Ä¢ {{ offering.description }}
                            {% if offering.price %} - {{ offering.price }}{% endif %}
                        {% endif %}
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            {% if group.deal_count > 1 and not group.is_schedule_group %}
            <div class="deal-group-count">
                <small>{{ group.deal_count }} offers available</small>
            </div>
            {% endif %}
        </div>
        {% endfor %}
        
        {% if restaurant.scraping_info and restaurant.scraping_info.source_url %}
        <p class="source-link">
            <a href="{{ restaurant.scraping_info.source_url }}" target="_blank">
                View on restaurant website ‚Üí
            </a>
        </p>
        {% endif %}
    </section>
    
    {% elif restaurant.happy_hour_times %}
    <!-- Static Happy Hour Schedule -->
    <section class="static-deals-section">
        <h3>Happy Hour Schedule</h3>
        <p class="static-deals-description">
            Static information - live data not yet available
        </p>
        {% for time in restaurant.happy_hour_times %}
        <div class="static-time-entry">
            {{ time }}
        </div>
        {% endfor %}
    </section>
    {% endif %}
    
    <!-- Special Tags -->
    {% if restaurant.special_notes %}
      {% set non_plant_notes = [] %}
      {% for note in restaurant.special_notes %}
        {% if 'plant-based' not in note | lower %}
          {% set _ = non_plant_notes.append(note) %}
        {% endif %}
      {% endfor %}
      {% if non_plant_notes %}
    <section class="special-tags">
        <div class="tags">
            {% for note in non_plant_notes %}
            <mark class="tag">{{ note }}</mark>
            {% endfor %}
        </div>
    </section>
      {% endif %}
    {% endif %}
    
    <!-- Restaurant Details -->
    <div class="restaurant-details">
        <!-- Location & Contact -->
        <section class="detail-section">
            <h3>Location & Contact</h3>
            <div class="info-grid">
                {% if restaurant.address %}
                <div class="info-item">
                    <span class="info-label">Address:</span>
                    <span class="info-value">
                        <a href="https://maps.google.com/?q={{ restaurant.address | urlencode }}" target="_blank">üìç {{ restaurant.address }}</a>
                    </span>
                </div>
                {% endif %}
                
                {% if restaurant.sub_location %}
                <div class="info-item">
                    <span class="info-label">Neighborhood:</span>
                    <span class="info-value">{{ restaurant.sub_location }}</span>
                </div>
                {% endif %}
                
                <div class="info-item">
                    <span class="info-label">District:</span>
                    <span class="info-value">{{ restaurant.area }}</span>
                </div>
                
                {% if restaurant.website %}
                <div class="info-item">
                    <span class="info-label">Website:</span>
                    <span class="info-value">
                        <a href="{{ restaurant.website }}" target="_blank">Visit Website</a>
                    </span>
                </div>
                {% endif %}
                
                {% if restaurant.phone %}
                <div class="info-item">
                    <span class="info-label">Phone:</span>
                    <span class="info-value">{{ restaurant.phone }}</span>
                </div>
                {% endif %}
            </div>
        </section>
        
        <!-- Restaurant Info -->
        <section class="detail-section">
            <h3>Restaurant Info</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Cuisine:</span>
                    <span class="info-value">
                        {% if restaurant.cuisine %}{{ restaurant.cuisine | cuisine_emoji }}{% endif %}
                        {% if restaurant.special_notes %}
                          {% for note in restaurant.special_notes %}
                            {% if 'plant-based' in note | lower %}
                        <span class="cuisine plant-based" style="margin-left: 0.5rem;">üå± Plant-Based</span>
                            {% endif %}
                          {% endfor %}
                        {% endif %}
                    </span>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Action Buttons -->
    <section class="actions">
        {% if restaurant.website %}
        <a href="{{ restaurant.website }}" target="_blank" role="button">Visit Restaurant Website</a>
        {% endif %}
        
        <a href="../index.html" role="button" class="outline">Browse More Deals</a>
        
        <a href="../stats.html" role="button" class="outline">View System Stats</a>
    </section>
    
    <!-- Similar Restaurants -->
    <section>
        <h3>More Great Options in {{ restaurant.area }}</h3>
        <p><a href="../index.html#{{ restaurant.area | slugify }}">Explore other restaurants in {{ restaurant.area }} ‚Üí</a></p>
    </section>
    
    {% if restaurant.last_updated %}
    <div class="last-updated">
        Data last updated: {{ restaurant.last_updated | time_since }}
    </div>
    {% endif %}
{% endblock %}